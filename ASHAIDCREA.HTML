<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ASHA PDF Generator</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
.body-wrap, body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* layered background */
body::before{
    content: '';
    position: fixed;
    inset: 0;
    z-index: -2;
    background: radial-gradient(1200px 600px at 10% 20%, rgba(58,160,255,0.08), transparent 15%),
                radial-gradient(1000px 500px at 90% 80%, rgba(11,115,211,0.06), transparent 18%),
                linear-gradient(180deg, #eaf4ff 0%, #f7fbff 50%, #eef7fb 100%);
}

/* subtle pattern overlay */
body::after{
    content: '';
    position: fixed;
    inset: 0;
    z-index: -1;
    background-image: radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
    background-size: 36px 36px;
    opacity: 0.6;
}
.card {
    background: rgba(255,255,255,0.85);
    backdrop-filter: blur(6px) saturate(120%);
    border-radius: 20px;
    padding: 30px;
    width: 520px;
    box-shadow: 0 12px 40px rgba(13,38,70,0.12), inset 0 1px 0 rgba(255,255,255,0.6);
}
.list-item {
    margin:5px 0; padding:6px; background:#f0f0f0; border-radius:6px;
    display:flex; justify-content:space-between;
}
/* New styles */
.card h3{display:flex;align-items:center;gap:12px;margin-bottom:18px}
.brand-dot{width:14px;height:14px;border-radius:50%;background:linear-gradient(135deg,#0b73d3,#3aa0ff);box-shadow:0 2px 6px rgba(11,115,211,0.35)}
input.form-control, select.form-select{border-radius:10px;border:1px solid #d6e3f5;padding:10px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.6);transition:box-shadow .15s ease,border-color .15s ease}
input.form-control:focus, select.form-select:focus{outline:none;border-color:#0b73d3;box-shadow:0 6px 20px rgba(11,115,211,0.12)}
.btn{border-radius:10px;box-shadow:0 6px 14px rgba(11,115,211,0.08)}
.btn-primary{background:linear-gradient(180deg,#0b73d3,#095bb5);border:none}
.btn-success{background:linear-gradient(180deg,#29a745,#1f8a36);border:none}
.btn-secondary{background:#eef2f6;border:none;color:#2d2d2d}
.list-item{align-items:center;gap:12px;padding:10px}
.list-left{display:flex;align-items:center;gap:12px}
.avatar{width:42px;height:42px;border-radius:8px;background:linear-gradient(135deg,#3aa0ff,#0b73d3);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
.list-item button{opacity:.95}
.list-item:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(11,115,211,0.06)}
.empty-msg{padding:18px;text-align:center;color:#6b7280}
</style>
</head>
<body>
<div class="card">
<h3>REGESTER NEW ASHA WORKER</h3>
<div class="mb-2">
<label>State</label>
<select id="stateSelect" class="form-select">
<label>State</label>
  
    <option value="">--Select State--</option>
    <option value="AP">Andhra Pradesh</option>
    <option value="AR">Arunachal Pradesh</option>
    <option value="AS">Assam</option>
    <option value="BR">Bihar</option>
    <option value="CG">Chhattisgarh</option>
    <option value="GA">Goa</option>
    <option value="GJ">Gujarat</option>
    <option value="HR">Haryana</option>
    <option value="HP">Himachal Pradesh</option>
    <option value="JH">Jharkhand</option>
    <option value="KA">Karnataka</option>
    <option value="KL">Kerala</option>
    <option value="MP">Madhya Pradesh</option>
    <option value="MH">Maharashtra</option>
    <option value="MN">Manipur</option>
    <option value="ML">Meghalaya</option>
    <option value="MZ">Mizoram</option>
    <option value="NL">Nagaland</option>
    <option value="OD">Odisha</option>
    <option value="PB">Punjab</option>
    <option value="RJ">Rajasthan</option>
    <option value="SK">Sikkim</option>
    <option value="TN">Tamil Nadu</option>
    <option value="TS">Telangana</option>
    <option value="TR">Tripura</option>
    <option value="UP">Uttar Pradesh</option>
    <option value="UK">Uttarakhand</option>
    <option value="WB">West Bengal</option>
    <option value="AN">Andaman and Nicobar Islands</option>
    <option value="CH">Chandigarh</option>
    <option value="DN">Dadra and Nagar Haveli and Daman and Diu</option>
    <option value="DL">Delhi</option>
    <option value="JK">Jammu and Kashmir</option>
    <option value="LA">Ladakh</option>
    <option value="LD">Lakshadweep</option>
    <option value="PY">Puducherry</option>
  
</select>
</div>

<div class="mb-2">
<label>Area Pin Code</label>
<!-- use text to preserve leading zeros; enforce exactly 6 digits -->
<input type="text" id="districtCode" class="form-control" placeholder="590001" inputmode="numeric" pattern="\d{6}" maxlength="6" title="Enter a 6-digit PIN code">
</div>

<div class="mb-2">
<label>Name</label>
<input type="text" id="ashaName" class="form-control" placeholder="Asha Devi">
</div>

<div class="mb-2">
<label> Contact Number</label>
<!-- enforce 10 digits exactly -->
<input type="tel" id="numberPart" class="form-control" placeholder="9876543210" inputmode="tel" pattern="\d{10}" maxlength="10" title="Enter a 10-digit mobile number">
</div>

<button id="addBtn" class="btn btn-primary w-100 mb-2">Add Worker</button>
<button id="generatePDF" class="btn btn-success w-100 mb-2">Generate PDF</button>
<button id="backBtn" class="btn btn-secondary w-100 mb-3">Back</button>

<h5>Worker List</h5>
<div id="workerList"></div>
</div>

<!-- Validation modal: require password before adding a worker -->
<div id="validationModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:9999; align-items:center; justify-content:center;">
    <div style="max-width:360px; margin:80px auto; background:#fff; border-radius:10px; padding:18px; box-shadow:0 12px 40px rgba(0,0,0,0.2);">
        <h5 style="margin:0 0 8px 0">Validation Required</h5>
        <p style="margin:0 0 12px 0; color:#555; font-size:14px">Enter the validation password to proceed with adding a worker.</p>
        <input id="validationPassword" type="password" class="form-control" placeholder="Validation password" style="margin-bottom:12px;">
        <div style="display:flex; gap:8px; justify-content:flex-end;">
            <button id="cancelValidateBtn" class="btn btn-secondary">Cancel</button>
            <button id="validateBtn" class="btn btn-primary">Validate</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const workers = [];
const stateSelect = document.getElementById('stateSelect');
const districtInput = document.getElementById('districtCode');
const nameInput = document.getElementById('ashaName');
const numberInput = document.getElementById('numberPart');
const workerList = document.getElementById('workerList');

function buildId(w){ return `ASHA/${w.state}/${w.district || 'NA'}/${w.number}`; }

function renderList(){
    workerList.innerHTML = '';
    if(workers.length === 0){
        const msg = document.createElement('div');
        msg.className = 'empty-msg';
        msg.textContent = 'No workers added yet. Use the form above to add ASHA workers.';
        workerList.appendChild(msg);
        return;
    }
    workers.forEach((w,i)=>{
        const div = document.createElement('div');
        div.className = 'list-item';

        const left = document.createElement('div');
        left.className = 'list-left';
        const avatar = document.createElement('div');
        avatar.className = 'avatar';
        const initials = (w.name || '').split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase() || 'A';
        avatar.textContent = initials;
        const info = document.createElement('div');
        info.innerHTML = `<div style="font-weight:600">${i+1}. ${w.name}</div><div style="font-size:12px;color:#6b7280">${buildId(w)}</div>`;
        left.appendChild(avatar);
        left.appendChild(info);

        const del = document.createElement('button');
        del.className = 'btn btn-sm btn-danger';
        del.textContent = 'Delete';
        del.addEventListener('click', ()=> deleteWorker(i));
        div.appendChild(left);
        div.appendChild(del);
        workerList.appendChild(div);
    });
}

function deleteWorker(i){ workers.splice(i,1); renderList(); }

// helper: open a jsPDF doc in a new tab by creating a blob URL; fallback to download if popup blocked
function openDocInNewTab(doc, filename){
    try{
        const blob = doc.output('blob');
        const url = URL.createObjectURL(blob);
        const w = window.open('', '_blank');
        if(!w){ doc.save(filename); return; }
        w.document.title = filename;
        const iframe = w.document.createElement('iframe');
        iframe.style.width = '100%'; iframe.style.height = '100vh'; iframe.src = url;
        w.document.body.style.margin = '0';
        w.document.body.appendChild(iframe);
    }catch(e){
        // fallback: save
        doc.save(filename);
    }
}

// Extracted add logic into a reusable function — will be called after validation
function addWorker() {
    const st = stateSelect.value.trim();
    const dc = districtInput.value.trim();
    const nm = nameInput.value.trim();
    const num = numberInput.value.trim();
    // basic required checks
    if(!st || !nm || !num){ alert('Fill all required fields (State, Name, Number)'); return false; }

    // validate pin code: exactly 6 digits
    const pinRe = /^\d{6}$/;
    if(dc && !pinRe.test(dc)){
        alert('Please enter a valid 6-digit PIN code (Area Pin Code).');
        districtInput.focus();
        return false;
    }

    // sanitize and validate phone number: exactly 10 digits and not all zeros
    const rawNum = num.replace(/\D/g, '');
    const phoneRe = /^\d{10}$/;
    if(!phoneRe.test(rawNum) || /^0{10}$/.test(rawNum)){
        alert('Please enter a valid 10-digit contact number (digits only) and not all zeros.');
        numberInput.focus();
        return false;
    }

    const worker = {name:nm, state:st, district:dc, number:rawNum};
    workers.push(worker);
    renderList();
    // clear inputs
    nameInput.value=''; districtInput.value=''; numberInput.value='';
    return true;
}

// Show/hide validation modal
function showValidationModal(){
    document.getElementById('validationModal').style.display = 'flex';
    document.getElementById('validationPassword').value = '';
    document.getElementById('validationPassword').focus();
}
function hideValidationModal(){
    document.getElementById('validationModal').style.display = 'none';
}

// When user clicks Add Worker, require validation password first
document.getElementById('addBtn').addEventListener('click', ()=>{
    showValidationModal();
});

// Wire modal buttons
document.getElementById('cancelValidateBtn').addEventListener('click', ()=>{
    hideValidationModal();
});
document.getElementById('validateBtn').addEventListener('click', ()=>{
    const pwd = document.getElementById('validationPassword').value;
    // Demo validation password — replace with secure check as needed
    const VALID_PASSWORD = 'inventra';
    if(pwd === VALID_PASSWORD){
        // attempt to add; only hide if add succeeded
        const ok = addWorker();
        if(ok) hideValidationModal();
    } else {
        alert('Invalid validation password');
        document.getElementById('validationPassword').focus();
    }
});

// Generate combined PDF and open in new tab
document.getElementById('generatePDF').addEventListener('click', ()=>{
    if(!workers.length){ alert('Add at least one worker'); return; }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({unit:'pt', format:'a4'});

    // Index page(s)
    doc.setFontSize(18);
    doc.text('ASHA Workers Index', 40, 50);
    doc.setFontSize(12);
    let y = 80;
    const itemsPerPage = 40;
    const indexPages = Math.ceil(workers.length / itemsPerPage);

    workers.forEach((w,i)=>{
        if(i>0 && i % itemsPerPage === 0){ doc.addPage(); y = 60; }
        const line = `${i+1}. ${w.name} (${buildId(w)})`;
        doc.text(line, 50, y);
        try{ doc.link(50, y-8, 300, 12, {pageNumber: indexPages + i + 1}); }catch(e){}
        y += 15;
    });

    // Worker detail pages
    workers.forEach((w,i)=>{
        doc.addPage();
        doc.setFontSize(16);
        doc.text('ASHA Worker Details', 40, 50);
        doc.setFontSize(12);
        const startY = 80;
        doc.text(`Name: ${w.name}`, 40, startY);
        doc.text(`State: ${w.state}`, 40, startY + 20);
        doc.text(`District: ${w.district || 'N/A'}`, 40, startY + 40);
        doc.text(`Number: ${w.number}`, 40, startY + 60);
        doc.text(`ASHA ID: ${buildId(w)}`, 40, startY + 80);
        doc.text(`Generated: ${new Date().toLocaleString()}`, 40, startY + 100);
    });

    // open combined PDF in new tab (fallback to download)
    openDocInNewTab(doc, 'ASHA_Workers_All.pdf');
});
</script>
<script>
// Back button behavior
document.getElementById('backBtn').addEventListener('click', ()=>{
    // Always navigate back to the homepage for admin flows
    window.location.href = 'HOMEPAGE.HTML';
});
</script>
</body>
</html>